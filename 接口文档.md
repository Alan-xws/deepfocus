# DeepFocus 深度专注应用接口文档

## 1. 项目概述

DeepFocus是一款基于番茄工作法的深度专注应用，帮助用户提高工作效率，培养良好的专注习惯。应用提供专注记录、任务管理、成就系统、分享广场等功能，支持多设备同步和个性化设置。

## 2. 接口设计原则

- RESTful API设计风格
- 统一的响应格式
- 合理的错误处理
- 支持分页、排序和过滤
- 身份认证与授权

## 3. 认证与授权

### 3.1 JWT认证

所有需要认证的接口都需要在请求头中携带JWT令牌：

```http
Authorization: Bearer {token}
```

## 4. 接口列表

### 4.1 用户管理接口

#### 4.1.1 用户注册

```http
POST /api/auth/register
Content-Type: application/json

{
  "username": "example",
  "email": "example@example.com",
  "password": "password123"
}
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "id": "user-1",
    "username": "example",
    "email": "example@example.com",
    "avatar": "https://ui-avatars.com/api/?name=example&background=random",
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  },
  "message": "注册成功"
}
```

#### 4.1.2 用户登录

```http
POST /api/auth/login
Content-Type: application/json

{
  "email": "example@example.com",
  "password": "password123"
}
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "id": "user-1",
    "username": "example",
    "email": "example@example.com",
    "avatar": "https://ui-avatars.com/api/?name=example&background=random",
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  },
  "message": "登录成功"
}
```

#### 4.1.3 获取用户信息

```http
GET /api/user/profile
Authorization: Bearer {token}
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "id": "user-1",
    "username": "example",
    "email": "example@example.com",
    "avatar": "https://ui-avatars.com/api/?name=example&background=random",
    "createdAt": "2023-01-01T00:00:00Z"
  },
  "message": "获取成功"
}
```

#### 4.1.4 更新用户信息

```http
PUT /api/user/profile
Authorization: Bearer {token}
Content-Type: application/json

{
  "username": "newusername",
  "avatar": "https://example.com/avatar.jpg"
}
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "id": "user-1",
    "username": "newusername",
    "email": "example@example.com",
    "avatar": "https://example.com/avatar.jpg",
    "updatedAt": "2023-01-02T00:00:00Z"
  },
  "message": "更新成功"
}
```

### 4.2 任务管理接口

#### 4.2.1 获取任务列表

```http
GET /api/tasks
Authorization: Bearer {token}
```

**响应示例：**

```json
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "name": "学习编程",
      "createdAt": "2023-01-01T00:00:00Z",
      "updatedAt": "2023-01-01T00:00:00Z"
    },
    {
      "id": 2,
      "name": "健身",
      "createdAt": "2023-01-02T00:00:00Z",
      "updatedAt": "2023-01-02T00:00:00Z"
    }
  ],
  "message": "获取成功"
}
```

#### 4.2.2 创建任务

```http
POST /api/tasks
Authorization: Bearer {token}
Content-Type: application/json

{
  "name": "阅读"
}
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "id": 3,
    "name": "阅读",
    "createdAt": "2023-01-03T00:00:00Z",
    "updatedAt": "2023-01-03T00:00:00Z"
  },
  "message": "创建成功"
}
```

#### 4.2.3 更新任务

```http
PUT /api/tasks/{id}
Authorization: Bearer {token}
Content-Type: application/json

{
  "name": "更新后的任务名称"
}
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "id": 3,
    "name": "更新后的任务名称",
    "createdAt": "2023-01-03T00:00:00Z",
    "updatedAt": "2023-01-04T00:00:00Z"
  },
  "message": "更新成功"
}
```

#### 4.2.4 删除任务

```http
DELETE /api/tasks/{id}
Authorization: Bearer {token}
```

**响应示例：**

```json
{
  "code": 200,
  "data": null,
  "message": "删除成功"
}
```

### 4.3 专注记录接口

#### 4.3.1 获取专注记录列表

```http
GET /api/records
Authorization: Bearer {token}

# 可选查询参数
?startDate=2023-01-01&endDate=2023-01-31&taskId=1&type=focus&page=1&pageSize=10
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "list": [
      {
        "id": 1,
        "taskId": 1,
        "taskName": "学习编程",
        "duration": 1500,
        "date": "2023-01-01T10:00:00Z",
        "type": "focus"
      },
      {
        "id": 2,
        "taskId": 1,
        "taskName": "学习编程",
        "duration": 300,
        "date": "2023-01-01T10:25:00Z",
        "type": "short-break"
      }
    ],
    "total": 100,
    "page": 1,
    "pageSize": 10
  },
  "message": "获取成功"
}
```

#### 4.3.2 创建专注记录

```http
POST /api/records
Authorization: Bearer {token}
Content-Type: application/json

{
  "taskId": 1,
  "duration": 1500,
  "type": "focus"
}
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "id": 3,
    "taskId": 1,
    "taskName": "学习编程",
    "duration": 1500,
    "date": "2023-01-04T10:00:00Z",
    "type": "focus"
  },
  "message": "创建成功"
}
```

#### 4.3.3 获取专注统计数据

```http
GET /api/records/stats
Authorization: Bearer {token}

# 可选查询参数
?period=day|week|month|year
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "todayFocusDuration": 3000,
    "weekFocusDuration": 21000,
    "monthFocusDuration": 90000,
    "totalFocusSessions": 120,
    "taskFocusDuration": {
      "1": {
        "name": "学习编程",
        "duration": 60000
      },
      "2": {
        "name": "健身",
        "duration": 30000
      }
    }
  },
  "message": "获取成功"
}
```

### 4.4 成就系统接口

#### 4.4.1 获取成就列表

```http
GET /api/achievements
Authorization: Bearer {token}
```

**响应示例：**

```json
{
  "code": 200,
  "data": [
    {
      "id": "consecutive_3",
      "name": "初学者",
      "description": "连续专注3天",
      "unlocked": true,
      "unlockDate": "2023-01-03T00:00:00Z",
      "progress": 3,
      "target": 3,
      "type": "consecutive"
    },
    {
      "id": "total_10",
      "name": "起步",
      "description": "累计完成10个番茄钟",
      "unlocked": false,
      "progress": 8,
      "target": 10,
      "type": "total"
    }
  ],
  "message": "获取成功"
}
```

#### 4.4.2 获取连续打卡天数

```http
GET /api/achievements/consecutive-days
Authorization: Bearer {token}
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "consecutiveDays": 5
  },
  "message": "获取成功"
}
```

### 4.5 分享广场接口

#### 4.5.1 获取分享帖子列表

```http
GET /api/square/posts
Authorization: Bearer {token}

# 可选查询参数
?page=1&pageSize=10&sort=date
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "list": [
      {
        "id": "1",
        "userId": "user1",
        "username": "专注大师",
        "avatar": "https://picsum.photos/id/1/40/40",
        "content": "今天完成了3小时的深度工作，感觉很棒！",
        "duration": 180,
        "date": "2023-01-04T00:00:00Z",
        "likes": 42,
        "comments": 5,
        "isLiked": false,
        "image": "https://picsum.photos/id/100/600/400"
      }
    ],
    "total": 100,
    "page": 1,
    "pageSize": 10
  },
  "message": "获取成功"
}
```

#### 4.5.2 创建分享帖子

```http
POST /api/square/posts
Authorization: Bearer {token}
Content-Type: application/json

{
  "content": "今天完成了2小时的深度工作",
  "duration": 120,
  "image": "https://example.com/image.jpg"
}
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "id": "2",
    "userId": "currentUser",
    "username": "当前用户",
    "avatar": "https://ui-avatars.com/api/?name=User&background=random",
    "content": "今天完成了2小时的深度工作",
    "duration": 120,
    "date": "2023-01-05T00:00:00Z",
    "likes": 0,
    "comments": 0,
    "isLiked": false,
    "image": "https://example.com/image.jpg"
  },
  "message": "创建成功"
}
```

#### 4.5.3 切换点赞状态

```http
POST /api/square/posts/{postId}/like
Authorization: Bearer {token}
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "isLiked": true,
    "likes": 43
  },
  "message": "操作成功"
}
```

#### 4.5.4 获取帖子评论

```http
GET /api/square/posts/{postId}/comments
Authorization: Bearer {token}

# 可选查询参数
?page=1&pageSize=10
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "list": [
      {
        "id": "comment-1",
        "userId": "user-2",
        "username": "专注达人",
        "avatar": "https://ui-avatars.com/api/?name=Focus&background=random",
        "content": "太棒了！我也要向你学习这种专注精神。",
        "date": "2023-01-04T10:00:00Z",
        "likes": 5,
        "isLiked": false
      }
    ],
    "total": 5,
    "page": 1,
    "pageSize": 10
  },
  "message": "获取成功"
}
```

#### 4.5.5 添加评论

```http
POST /api/square/posts/{postId}/comments
Authorization: Bearer {token}
Content-Type: application/json

{
  "content": "这太棒了！"
}
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "id": "comment-3",
    "userId": "currentUser",
    "username": "当前用户",
    "avatar": "https://ui-avatars.com/api/?name=User&background=random",
    "content": "这太棒了！",
    "date": "2023-01-05T10:00:00Z",
    "likes": 0,
    "isLiked": false
  },
  "message": "创建成功"
}
```

#### 4.5.6 切换评论点赞状态

```http
POST /api/square/comments/{commentId}/like
Authorization: Bearer {token}
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "isLiked": true,
    "likes": 6
  },
  "message": "操作成功"
}
```

#### 4.5.7 添加回复

```http
POST /api/square/comments/{commentId}/replies
Authorization: Bearer {token}
Content-Type: application/json

{
  "content": "感谢支持！"
}
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "id": "reply-2",
    "userId": "currentUser",
    "username": "当前用户",
    "avatar": "https://ui-avatars.com/api/?name=User&background=random",
    "content": "感谢支持！",
    "date": "2023-01-05T10:30:00Z",
    "likes": 0,
    "isLiked": false
  },
  "message": "创建成功"
}
```

### 4.6 设置管理接口

#### 4.6.1 获取用户设置

```http
GET /api/settings
Authorization: Bearer {token}
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "focusTime": 25,
    "shortBreakTime": 5,
    "longBreakTime": 15,
    "longBreakInterval": 4,
    "theme": "dark",
    "soundEnabled": true,
    "volume": 70,
    "notificationsEnabled": true,
    "accentColor": "#3b82f6"
  },
  "message": "获取成功"
}
```

#### 4.6.2 更新用户设置

```http
PUT /api/settings
Authorization: Bearer {token}
Content-Type: application/json

{
  "focusTime": 30,
  "theme": "light",
  "accentColor": "#10b981"
}
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "focusTime": 30,
    "shortBreakTime": 5,
    "longBreakTime": 15,
    "longBreakInterval": 4,
    "theme": "light",
    "soundEnabled": true,
    "volume": 70,
    "notificationsEnabled": true,
    "accentColor": "#10b981"
  },
  "message": "更新成功"
}
```

#### 4.6.3 重置默认设置

```http
DELETE /api/settings
Authorization: Bearer {token}
```

**响应示例：**

```json
{
  "code": 200,
  "data": {
    "focusTime": 25,
    "shortBreakTime": 5,
    "longBreakTime": 15,
    "longBreakInterval": 4,
    "theme": "dark",
    "soundEnabled": true,
    "volume": 70,
    "notificationsEnabled": true,
    "accentColor": "#3b82f6"
  },
  "message": "重置成功"
}
```

## 5. 响应格式

### 5.1 成功响应

```json
{
  "code": 200,
  "data": { /* 响应数据 */ },
  "message": "操作成功"
}
```

### 5.2 错误响应

```json
{
  "code": 400,
  "data": null,
  "message": "错误信息"
}
```

## 6. 错误码列表

| 错误码 | 描述 |
| --- | --- |
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 禁止访问 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |
| 502 | 网关错误 |
| 503 | 服务不可用 |

## 7. 数据类型定义

### 7.1 用户（User）

```json
{
  "id": "user-1",
  "username": "example",
  "email": "example@example.com",
  "avatar": "https://example.com/avatar.jpg",
  "createdAt": "2023-01-01T00:00:00Z",
  "updatedAt": "2023-01-01T00:00:00Z"
}
```

### 7.2 任务（Task）

```json
{
  "id": 1,
  "name": "学习编程",
  "createdAt": "2023-01-01T00:00:00Z",
  "updatedAt": "2023-01-01T00:00:00Z"
}
```

### 7.3 专注记录（FocusRecord）

```json
{
  "id": 1,
  "taskId": 1,
  "taskName": "学习编程",
  "duration": 1500,
  "date": "2023-01-01T10:00:00Z",
  "type": "focus"
}
```

### 7.4 成就（Achievement）

```json
{
  "id": "consecutive_3",
  "name": "初学者",
  "description": "连续专注3天",
  "unlocked": true,
  "unlockDate": "2023-01-03T00:00:00Z",
  "progress": 3,
  "target": 3,
  "type": "consecutive"
}
```

### 7.5 分享帖子（SharePost）

```json
{
  "id": "1",
  "userId": "user1",
  "username": "专注大师",
  "avatar": "https://example.com/avatar.jpg",
  "content": "今天完成了3小时的深度工作，感觉很棒！",
  "duration": 180,
  "date": "2023-01-04T00:00:00Z",
  "likes": 42,
  "comments": 5,
  "isLiked": false,
  "image": "https://example.com/image.jpg"
}
```

### 7.6 评论（Comment）

```json
{
  "id": "comment-1",
  "userId": "user-2",
  "username": "专注达人",
  "avatar": "https://example.com/avatar.jpg",
  "content": "太棒了！我也要向你学习这种专注精神。",
  "date": "2023-01-04T10:00:00Z",
  "likes": 5,
  "isLiked": false,
  "replies": [ /* 回复列表 */ ]
}
```

### 7.7 设置（Settings）

```json
{
  "focusTime": 25,
  "shortBreakTime": 5,
  "longBreakTime": 15,
  "longBreakInterval": 4,
  "theme": "dark",
  "soundEnabled": true,
  "volume": 70,
  "notificationsEnabled": true,
  "accentColor": "#3b82f6"
}
```

## 8. 接口版本控制

接口版本通过URL路径进行控制：

```http
/api/v1/...
/api/v2/...
```

## 9. 安全考虑

- 使用HTTPS加密传输
- 实现JWT令牌认证
- 密码加密存储
- 接口请求频率限制
- 输入参数验证
- 敏感数据脱敏

## 10. 性能优化

- 接口缓存策略
- 数据库索引优化
- 响应数据压缩
- 分页查询
- 懒加载和预加载

## 11. 测试环境

测试环境API地址：`https://test.deepfocus.example.com/api`

## 12. 生产环境

生产环境API地址：`https://api.deepfocus.example.com/api`

## 13. 联系方式

如有问题或建议，请联系：

- 邮箱：api@deepfocus.example.com
- 文档更新时间：2025-04-29